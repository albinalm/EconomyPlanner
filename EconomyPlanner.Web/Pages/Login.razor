@inject NavigationManager NavManager
@page "/login"
@using EconomyPlanner.Web.Services.Interfaces

<PageTitle>Logga in på ditt hushåll</PageTitle>

<h1>Logga in på ditt hushåll</h1>
<br/>
<p>Vänligen mata in ditt hushålls-ID nedan:</p>
<input type="text" id="txt_guid" name="txt_guid" @bind="TxtGuidText">
<button @onclick="SetGuid">Logga in</button>

@code{

    [Inject]
    private IHouseholdService HouseholdService { get; set; } = default!;

    private string TxtGuidText { get; set; } = "";

    private async Task SetGuid()
    {
        if (await HouseholdService.AttemptLogin(TxtGuidText))
        {
            
            NavManager.NavigateTo("/", forceLoad: true);
        }
        
        Console.WriteLine("Inloggning misslyckades :(");
    }

    protected override async Task OnInitializedAsync()
    {
        if (await HouseholdService.HasSavedLogin())
        {
            var login = await HouseholdService.GetGuid();
            if (!string.IsNullOrEmpty(login))
            {
                if (await HouseholdService.AttemptLogin(login))
                {
                    NavManager.NavigateTo("/", forceLoad: true);
                }
            }
        }
            
    }

}